###############################################################################
# API Test Collection
# Use with REST Client extension in VS Code
# Base URL: http://localhost:3000
# 
# Routers:
# - Organization Router: /api/v1/departments
# - Starter Router: /api/v1/starters, /api/v1/admin/starters
###############################################################################

@baseUrl = http://54.251.28.203:3000
@apiVersion = /api/v1

###############################################################################
# HEALTH CHECK
###############################################################################

### Ping test
GET {{baseUrl}}/ping/100

###############################################################################
# DEPARTMENT ENDPOINTS (Organization Router)
# Routes: GET /departments, POST /departments, PATCH /departments/:id
###############################################################################

### 1. List Departments - Basic (with defaults)
GET {{baseUrl}}{{apiVersion}}/departments

### 2. List Departments - With pagination
GET {{baseUrl}}{{apiVersion}}/departments?page=1&limit=5

### 3. List Departments - Filter by business unit
GET {{baseUrl}}{{apiVersion}}/departments?business_unit_id=1

### 4. List Departments - Include subdepartments
GET {{baseUrl}}{{apiVersion}}/departments?business_unit_id=5&include_subdepartments=true

### 5. List Departments - All parameters
GET {{baseUrl}}{{apiVersion}}/departments?business_unit_id=1&page=1&limit=2&include_subdepartments=false

### 6. Create Department - Success case with all fields
POST {{baseUrl}}{{apiVersion}}/departments
Content-Type: application/json

{
  "full_name": "Backend Engineering Team",
  "shortname": "BE",
  "business_unit_id": 1,
  "group_department_id": 5,
  "leader_id": 10
}

### 7. Create Department - Minimal required fields
POST {{baseUrl}}{{apiVersion}}/departments
Content-Type: application/json

{
  "full_name": "New Department",
  "shortname": "ND"
}

### 8. Create Department - Without optional fields
POST {{baseUrl}}{{apiVersion}}/departments
Content-Type: application/json

{
  "full_name": "Independent Department",
  "shortname": "IND",
  "business_unit_id": 1
}

### 9. Create Department - Validation error (missing full_name)
POST {{baseUrl}}{{apiVersion}}/departments
Content-Type: application/json

{
  "shortname": "ERR"
}

### 10. Create Department - Validation error (shortname too short)
POST {{baseUrl}}{{apiVersion}}/departments
Content-Type: application/json

{
  "full_name": "Error Department",
  "shortname": "E"
}

### 11.1 Assign Leader for Department
PATCH {{baseUrl}}{{apiVersion}}/departments/1/leader
Content-Type: application/json

{
  "leader_id": 1
}
### 11.2
PATCH {{baseUrl}}{{apiVersion}}/departments/1/leader
Content-Type: application/json

{
  "domain": "duydh2"
}


### 12. Update Department - Update multiple fields
PATCH {{baseUrl}}{{apiVersion}}/departments/5
Content-Type: application/json

{
  "full_name": "Games Publishing Platform - Updated",
  "business_unit_id": 1,
  "leader_id": 7
}

### 13. Update Department - Partial update (name only)
PATCH {{baseUrl}}{{apiVersion}}/departments/9
Content-Type: application/json

{
  "full_name": "Backend Engineering Platform"
}

### 14. Update Department - Reassign to different business unit
PATCH {{baseUrl}}{{apiVersion}}/departments/12
Content-Type: application/json

{
  "business_unit_id": 2,
  "group_department_id": null
}

### 15. Update Department - Change parent department
PATCH {{baseUrl}}{{apiVersion}}/departments/10
Content-Type: application/json

{
  "group_department_id": 9
}

### 16. Update Department - Validation error (full_name too short)
PATCH {{baseUrl}}{{apiVersion}}/departments/1
Content-Type: application/json

{
  "full_name": "AB"
}

### 17. Update Department - Not found
PATCH {{baseUrl}}{{apiVersion}}/departments/9999
Content-Type: application/json

{
  "leader_id": 10
}

###############################################################################
# STARTER ENDPOINTS (Starter Router)
# Routes: POST /starters, GET /starters, GET /starters/:domain, 
#         PUT /starters/:domain, DELETE /starters/:domain
###############################################################################

### 18. Create Starter - Success case with all fields
POST {{baseUrl}}{{apiVersion}}/starters
Content-Type: application/json

{
  "domain": "newuser",
  "name": "New User",
  "email": "newuser@vng.com.vn",
  "mobile": "(+84) 0912345678",
  "work_phone": "0912345678 (1234)",
  "job_title": "Software Engineer",
  "department_id": 9,
  "line_manager_id": 1
}

### 19. Create Starter - Minimal required fields
POST {{baseUrl}}{{apiVersion}}/starters
Content-Type: application/json

{
  "domain": "testusser",
  "name": "Test User",
  "email": "testuser@vng.com.vn",
  "mobile": "(+84) 0987654321",
  "job_title": "Junior Developer",
  "department_id": 5
}

### 20. Create Starter - Validation error (missing domain)
POST {{baseUrl}}{{apiVersion}}/starters
Content-Type: application/json

{
  "name": "No Domain User",
  "email": "nodomain@vng.com.vn",
  "mobile": "0912345678",
  "work_phone": "0912345678",
  "job_title": "Developer"
}

### 21. Create Starter - Validation error (duplicate domain)
POST {{baseUrl}}{{apiVersion}}/starters
Content-Type: application/json

{
  "domain": "khoapda",
  "name": "Duplicate User",
  "email": "duplicate@vng.com.vn",
  "mobile": "0912345678",
  "work_phone": "0912345678",
  "job_title": "Developer"
}

### 22. Create Starter - Validation error (invalid email)
POST {{baseUrl}}{{apiVersion}}/starters
Content-Type: application/json

{
  "domain": "invalidemail",
  "name": "Invalid Email User",
  "email": "not-an-email",
  "mobile": "0912345678",
  "work_phone": "0912345678",
  "job_title": "Developer"
}

### 23. List Starters - Basic (with defaults)
GET {{baseUrl}}{{apiVersion}}/starters

### 24. List Starters - With pagination
GET {{baseUrl}}{{apiVersion}}/starters?page=2&limit=3

### 25. List Starters - With filters (department)
GET {{baseUrl}}{{apiVersion}}/starters?department_id=11

### 26. List Starters - With filters (business unit)
GET {{baseUrl}}{{apiVersion}}/starters?business_unit_id=100

### 27. List Starters - With sorting
GET {{baseUrl}}{{apiVersion}}/starters?sort_by=id&sort_order=desc

### 28. List Starters - Search with keyword (Elasticsearch if available)
GET {{baseUrl}}{{apiVersion}}/starters?q=khoa

### 29. List Starters - Full query with all parameters
GET {{baseUrl}}{{apiVersion}}/starters?q=engineer&page=1&limit=1&department_id=9&sort_by=created_at&sort_order=desc

### 30. Find Starter - Success case
GET {{baseUrl}}{{apiVersion}}/starters/khoapda

### 31. Find Starter - Not found case
GET {{baseUrl}}{{apiVersion}}/starters/nonexistent.user

### 32. Update Starter - Update all fields
PUT {{baseUrl}}{{apiVersion}}/starters/khoapda
Content-Type: application/json

{
  "email": "khoapda.updated@vng.com.vn",
  "mobile": "0987654321",
  "work_phone": "0987654321 (5555)",
  "job_title": "Senior Software Engineer",
  "department_id": 5,
  "line_manager_id": 7
}

### 33. Update Starter - Partial update (only job title)
PUT {{baseUrl}}{{apiVersion}}/starters/khoapda
Content-Type: application/json

{
  "job_title": "Lead Software Engineer"
}

### 34. Update Starter - Update department only
PUT {{baseUrl}}{{apiVersion}}/starters/khoapda
Content-Type: application/json

{
  "department_id": 8
}

### 35. Update Starter - Validation error (invalid email)
PUT {{baseUrl}}{{apiVersion}}/starters/khoapda
Content-Type: application/json

{
  "email": "invalid-email"
}

### 36. Update Starter - Not found
PUT {{baseUrl}}{{apiVersion}}/starters/nonexistent.user
Content-Type: application/json

{
  "job_title": "Lead Engineer"
}

### 37. Soft Delete Starter - Success case
DELETE {{baseUrl}}{{apiVersion}}/starters/testuser

### 38. Soft Delete Starter - Not found
DELETE {{baseUrl}}{{apiVersion}}/starters/nonexistent.user

###############################################################################
# ADMIN ENDPOINTS (Starter Router - Admin Routes)
# Routes: POST /admin/starters/reindex
# Note: Only available if Elasticsearch is configured
###############################################################################

### 39. Reindex All Starters to Elasticsearch
POST {{baseUrl}}{{apiVersion}}/admin/starters/reindex
Content-Type: application/json

###############################################################################
# EDGE CASES & ERROR SCENARIOS
###############################################################################

### 40. List Starters - Invalid page (negative)
GET {{baseUrl}}{{apiVersion}}/starters?page=-1&limit=10

### 41. List Starters - Invalid limit (too large)
GET {{baseUrl}}{{apiVersion}}/starters?page=1&limit=1000

### 42. List Starters - Invalid sort_by
GET {{baseUrl}}{{apiVersion}}/starters?sort_by=invalid_field

### 43. List Departments - Invalid page (zero)
GET {{baseUrl}}{{apiVersion}}/departments?page=0&limit=10

### 44. Update Starter - Empty body
PUT {{baseUrl}}{{apiVersion}}/starters/khoapda
Content-Type: application/json

{}

### 45. Update Department - Invalid ID
PATCH {{baseUrl}}{{apiVersion}}/departments/invalid
Content-Type: application/json

{
  "leader_id": 10
}

###############################################################################
# NESTED OBJECT TESTS (Verify Enrichment)
###############################################################################

### 46. List Starters - Verify nested department, line_manager, business_unit
GET {{baseUrl}}{{apiVersion}}/starters?limit=5

### 47. Find Starter - Verify nested objects in detail
GET {{baseUrl}}{{apiVersion}}/starters/khoapda

###############################################################################
# COMPLETE WORKFLOW TEST
###############################################################################

### 48. Workflow Step 1: Create new department
POST {{baseUrl}}{{apiVersion}}/departments
Content-Type: application/json
http://54.251.28.203:3000/api/v1/starters
{
  "full_name": "QA Engineering Team",
  "shortname": "QA",
  "business_unit_id": 1
}

### 49. Workflow Step 2: Create starter in new department (use department_id from step 1)
POST {{baseUrl}}{{apiVersion}}/starters
Content-Type: application/json

{
  "domain": "qaengineer",
  "name": "QA Engineer",
  "email": "qaengineer@vng.com.vn",
  "mobile": "0911111111",
  "work_phone": "0911111111",
  "job_title": "QA Engineer",
  "department_id": 1
}

### 50. Workflow Step 3: Update starter's department
PUT {{baseUrl}}{{apiVersion}}/starters/qaengineer
Content-Type: application/json

{
  "department_id": 9,
  "job_title": "Senior QA Engineer"
}

### 51. Workflow Step 4: Soft delete starter
DELETE {{baseUrl}}{{apiVersion}}/starters/qaengineer

### 52. Workflow Step 5: Verify starter is deleted (should return 404)
GET {{baseUrl}}{{apiVersion}}/starters/qaengineer
